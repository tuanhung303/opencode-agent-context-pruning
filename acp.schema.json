{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://raw.githubusercontent.com/tuanhung303/opencode-agent-context-pruning/master/acp.schema.json",
    "title": "ACP Plugin Configuration",
    "description": "Configuration schema for the OpenCode Agentic Context Pruning plugin",
    "type": "object",
    "additionalProperties": false,
    "properties": {
        "$schema": {
            "type": "string",
            "description": "JSON Schema reference for IDE autocomplete"
        },
        "enabled": {
            "type": "boolean",
            "default": true,
            "description": "Enable or disable the ACP plugin entirely"
        },
        "debug": {
            "type": "boolean",
            "default": false,
            "description": "Enable debug logging for troubleshooting"
        },
        "pruneNotification": {
            "type": "string",
            "enum": ["off", "minimal", "detailed"],
            "default": "minimal",
            "description": "Level of notification shown when pruning occurs: off (silent), minimal (summary), detailed (verbose)"
        },
        "commands": {
            "type": "object",
            "description": "Configuration for ACP slash commands (/acp)",
            "additionalProperties": false,
            "properties": {
                "enabled": {
                    "type": "boolean",
                    "default": true,
                    "description": "Enable ACP slash commands (/acp) for manual pruning control"
                },
                "protectedTools": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "default": [
                        "context_info",
                        "task",
                        "todowrite",
                        "todoread",
                        "context",
                        "batch",
                        "write",
                        "edit",
                        "plan_enter",
                        "plan_exit"
                    ],
                    "description": "Additional tool names to protect from pruning via commands (e.g., /acp sweep). Default includes context_info, task, todowrite, todoread, context, batch, write, edit, plan_enter, and plan_exit"
                }
            }
        },
        "protectedFilePatterns": {
            "type": "array",
            "items": {
                "type": "string"
            },
            "default": [
                "**/.env",
                "**/.env.*",
                "**/credentials.json",
                "**/secrets.json",
                "**/*.pem",
                "**/*.key",
                "**/package.json",
                "**/tsconfig.json",
                "**/pyproject.toml",
                "**/Cargo.toml"
            ],
            "description": "Glob patterns for files that should be protected from pruning (e.g., '**/*.config.ts'). Default includes env files, credentials, and config files"
        },
        "tools": {
            "type": "object",
            "description": "Configuration for pruning tools",
            "additionalProperties": false,
            "properties": {
                "settings": {
                    "type": "object",
                    "description": "General tool settings",
                    "additionalProperties": false,
                    "properties": {
                        "protectedTools": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "default": [
                                "context_info",
                                "task",
                                "todowrite",
                                "todoread",
                                "context",
                                "batch",
                                "write",
                                "edit",
                                "plan_enter",
                                "plan_exit"
                            ],
                            "description": "Tool names that should be protected from automatic pruning. Default includes context_info, task, todowrite, todoread, context, batch, write, edit, plan_enter, and plan_exit"
                        },
                        "enableAssistantMessagePruning": {
                            "type": "boolean",
                            "default": true,
                            "description": "Enable pruning of large assistant messages to reduce context size"
                        },
                        "enableReasoningPruning": {
                            "type": "boolean",
                            "default": true,
                            "description": "Enable pruning of reasoning/thinking blocks from assistant messages"
                        },
                        "enableVisibleAssistantHashes": {
                            "type": "boolean",
                            "default": true,
                            "description": "Show visible hash markers when assistant messages are pruned for transparency"
                        }
                    }
                },
                "discard": {
                    "type": "object",
                    "description": "Configure the discard tool for manually removing specific tool outputs from context",
                    "additionalProperties": false,
                    "properties": {
                        "enabled": {
                            "type": "boolean",
                            "default": true,
                            "description": "Enable the discard tool for manually removing specific tool outputs from context"
                        }
                    }
                },
                "distill": {
                    "type": "object",
                    "description": "Configuration for the distill tool",
                    "additionalProperties": false,
                    "properties": {
                        "enabled": {
                            "type": "boolean",
                            "default": true,
                            "description": "Enable the distill tool for summarizing tool outputs"
                        },
                        "showDistillation": {
                            "type": "boolean",
                            "default": false,
                            "description": "Show distillation output in the UI for debugging"
                        }
                    }
                },
                "todoReminder": {
                    "type": "object",
                    "description": "Remind agent to review/update todo list when stale",
                    "additionalProperties": false,
                    "properties": {
                        "enabled": {
                            "type": "boolean",
                            "default": true,
                            "description": "Enable todo reminder injection to remind agent to review/update todo list when stale"
                        },
                        "initialTurns": {
                            "type": "number",
                            "default": 5,
                            "description": "Number of turns before the first todo reminder is shown"
                        },
                        "repeatTurns": {
                            "type": "number",
                            "default": 4,
                            "description": "Number of turns between subsequent todo reminders"
                        },
                        "stuckTaskTurns": {
                            "type": "number",
                            "default": 12,
                            "description": "Number of turns a task can be in_progress before suggesting breakdown"
                        },
                        "maxContextTokens": {
                            "type": "number",
                            "default": 100000,
                            "description": "Maximum context token threshold for todo reminders"
                        }
                    }
                },
                "automataMode": {
                    "type": "object",
                    "description": "Autonomous reflection mechanism that injects strategic prompts",
                    "additionalProperties": false,
                    "properties": {
                        "enabled": {
                            "type": "boolean",
                            "default": true,
                            "description": "Enable automata mode reflection injection for autonomous strategic prompts"
                        },
                        "initialTurns": {
                            "type": "number",
                            "default": 8,
                            "description": "Number of turns of continuous work before first reflection prompt"
                        }
                    }
                }
            }
        },
        "strategies": {
            "type": "object",
            "description": "Automatic pruning strategies",
            "additionalProperties": false,
            "properties": {
                "purgeErrors": {
                    "type": "object",
                    "description": "Remove tool outputs that resulted in errors",
                    "additionalProperties": false,
                    "properties": {
                        "enabled": {
                            "type": "boolean",
                            "default": false,
                            "description": "Enable automatic purging of tool outputs that resulted in errors"
                        },
                        "turns": {
                            "type": "number",
                            "default": 4,
                            "description": "Number of turns after which error outputs are purged"
                        },
                        "protectedTools": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "default": [],
                            "description": "Tool names excluded from error purging"
                        }
                    }
                },
                "aggressivePruning": {
                    "type": "object",
                    "description": "Aggressive context pruning strategies for long sessions",
                    "additionalProperties": false,
                    "properties": {
                        "preset": {
                            "type": "string",
                            "enum": ["compact", "balanced", "verbose"],
                            "description": "Preset configuration to use as base. Options: compact (maximum cleanup), balanced (good for most use cases), verbose (minimal cleanup). Individual flags override preset values"
                        },
                        "pruneSourceUrls": {
                            "type": "boolean",
                            "default": true,
                            "description": "Prune source-url parts (web search citations) to reduce context size"
                        },
                        "pruneFiles": {
                            "type": "boolean",
                            "default": true,
                            "description": "Prune file attachment parts (images, documents) from old messages"
                        },
                        "pruneSnapshots": {
                            "type": "boolean",
                            "default": true,
                            "description": "Prune snapshot parts, keeping only the latest snapshot per file"
                        },
                        "pruneStepMarkers": {
                            "type": "boolean",
                            "default": true,
                            "description": "Filter out step-start/step-finish markers entirely from context"
                        },
                        "pruneToolInputs": {
                            "type": "boolean",
                            "default": true,
                            "description": "Strip verbose tool inputs (write/edit content) when superseded by newer operations"
                        },
                        "pruneRetryParts": {
                            "type": "boolean",
                            "default": true,
                            "description": "Auto-prune retry parts after successful completion of the operation"
                        },
                        "pruneUserCodeBlocks": {
                            "type": "boolean",
                            "default": true,
                            "description": "Truncate large code blocks in old user messages to save tokens"
                        },
                        "aggressiveFilePrune": {
                            "type": "boolean",
                            "default": true,
                            "description": "One-file-one-view: any file operation supersedes ALL previous operations on the same file"
                        },
                        "stateQuerySupersede": {
                            "type": "boolean",
                            "default": true,
                            "description": "State query supersede: ls, find, pwd, git status - keep only the latest execution"
                        },
                        "truncateOldErrors": {
                            "type": "boolean",
                            "default": true,
                            "description": "Truncate old error outputs to first line only, removing stack traces"
                        }
                    }
                }
            }
        }
    }
}
